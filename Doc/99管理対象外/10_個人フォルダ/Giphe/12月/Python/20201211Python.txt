+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
+-+-+-+-+-+-+-+-Python作業メモ+-+-+-+-+-+-+-+-
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

■Unity関連
https://isbn2.sbcr.jp/06657/

■エラー

■ショートカット


■課題


課題④：
データ作成済み→マップに投射、国を一つのまとまりとして考える難点あり→まとめてフォーカスを設定
→エリア間すべてにフォーカスが当たるのでチェック柄の図形になりそう
→可変長引数の扱いhttps://note.nkmk.me/python-argument-expand/
→*, ** を使うことで引数内でリスト、タプル、辞書型を展開することが可能


課題㊲：
ランクと数値とarea単位データのアルゴリズムの作成
固定ステータス←決定（固有ステータスの方が評価しやすいため）
p:50000, w:50000, t:50000, m:50000の場合
算出方法
・使用可能上限を設定
・強い建物を強い順で取得した総計

状態ステータス
h:40000, st:40000, a:40000
・作成時に大して意味をなさないので自由に

指向ステータス
c:10000→welfare?, i:100echnology?, strength:10000→power?, pop→military
・関係性あり

GDP
g:90000
・直に決定

最終基準値（適当）

SSS：500000000
SS:50000000
S:10000000
A:2500000
B:1000000
C:450000
D:150000
E:62500
F:12500

追加DB項目
→total,→

ランダムの場合まず、基本4パラメータの倍率を決定
基本P
p:50000, w:50000, t:50000, m:50000×（人口比なので無効）
→これらは
特殊P
i:30000, a:50000（必ずしも人口比ではない）

c:1-25
→単純倍率、上記パラメータで足りなければこちらをループで上昇させてもよい
→最初に決定しておく方法もある

課題㊶：KO
ThreadPoolExecutorが機能していない
→Thread処理はまだ未連携のため、そもそもデータの編集にそこまで負荷がかかっていない

課題㊻：OK
登録したデータをマップ出力→色付け
→無限ループに入る模様、正直思った通り
　→いつの間にか解決

課題㊼：OK
描画した長方形がどこの処理かわかりずらい、この課題txtも同じ
self.pw_map.coords

★解決
1.デバッグ結果：構文ミス→if→elif
2.ext_cntの西と南がハチャメチャだった。

課題⑧：
重複登録した場合、境界線がいびつに見える、むっくり

　
課題⑩：
CSVバルクインサート↓BlobStrage利用
CREATE EXTERNAL DATA SOURCE (Transact-SQL)

バルクインサートについて、サーバーから有効なパスである必要がある
https://docs.microsoft.com/ja-jp/sql/t-sql/statements/bulk-insert-transact-sql?view=sql-server-ver15
https://docs.microsoft.com/ja-jp/sql/t-sql/statements/bulk-insert-transact-sql?view=sql-server-ver15#f-importing-data-from-a-file-in-azure-blob-storage
いろいろ試したけど本特措だと思う
→クラウドは便利だけど、その分セキュリティ気にしないといけないから面倒くさい
SQLのbulk insertなんか相当だるいキーを発行したり、エラーも出るな
何が悪いのかわからないし、フローとも連携しなければいけないから本当にかったるい
というかネットの情報を試したけれどbulk insertは成功しなかったので相当質の悪いものだと思う
→明日フローで実行してみよう
盲点だったができる可能性がある、Youtubeで全員がVisualStudioで実施していた
もしかしたらクエリエディタが不完全なのかもしれない

BULKはできませんでした！

課題再び、バルク実行したいので→そうでないと性能クッソ悪い機能になってしまう
→つか、フローでなぜあれほど時間がかかるのかが謎である
→2500件程度に43分て頭おかしいっしょ。

★実行したいクエリ
CREATE EXTERNAL DATA SOURCE MyAzureInvoices
WITH
  ( LOCATION = 'https://blobverification.blob.core.windows.net/mycontainer' ,
    --CREDENTIAL = AccessAzureInvoices ,
    TYPE = BLOB_STORAGE
  ) ;

BULK INSERT sample
FROM 'user.csv'
WITH (DATA_SOURCE = 'MyAzureInvoices');

DROP EXTERNAL DATA SOURCE MyAzureStorage;

→削除する必要があるのか？あといちいちテーブルを開く時間が長すぎ

一時テーブルではBULK INSERT不可能なのではないか説
https://stackoverflow.com/questions/43813493/load-csv-from-blob-to-azure-sql-server-referenced-external-data-source-not-fou
→あほ。実行可能例あり
★いい感じかも
https://www.sqlshack.com/use-bulk-insert-import-data-locally-azure/

→とりあえず趣向を変えてまずはオンプレミスで挑戦する
　いきなりCREDITの部分でエラー、SSMSが必要、VisualStudioではだめなのだろうか
→SSMS重すぎだろ635MBってどういうことや


課題⑬：
ガチャの作成
召喚アニメーション、
モチーフは困窮した王国に召喚された勇者
ダンジョンの場合は、ダンジョンマスター召喚
課金
→次

課題⑯：
tobiを使って動かせるところまで、画面番号、画面表示
ショップ画面作成→ギャラリーにリストを表示させる


課題⑱：
鎧の騎士のアニメーション→きついかな？、セリフ
→歩くself.walk_frames_l.append(pg.transform.flip(frame, True, False))
→パス化ができた、トレース後→拡張でパス化。
→あとはアピアランス分割かな？

課題㉑：
課金画面クリックしたら
課金を促すポップアップを表示、下からスライドインしたい
GUI操作
pip install pygame-pgu

課題㉒：
・10連ガチャ、ゴロゴロと出てくる→ふわふわ
・10パターン分ふわふわ？
・キラキラが開店するエフェクト
・最大100連できてもよいかもしれない
→RarelityをEnumにしたのは正解だった。かなり楽に付与処理を実装できた
→選択したガチャ玉はselect_ballリストに格納済み

課題㉓：
とりあえず実装、ガチャ玉がそれぞれ時間をおいて下に流れていく処理を作成
ようやくspriteの面目躍如

課題㉔：×
スプライトシートを一括でblitする（背景とかも含めて）
で実装する。blitのコスパが安く作れる
→一括ではなく画像がひとまとまりになっているからと理由のSpriteSheetクラスだった

課題㉕：
クラス変数の方がそれぞれの玉の動きを追いやすい
https://qiita.com/wyamamo/items/48ce6f331546bc977cc0

課題㉖：OK
謎エラー、初めてのラムダ式で盛大にエラー
→なんか変な動きをしたのでカット
→普通にリストを抽出する形式に修正

課題㉖：
Azure SQL　WITH区周辺でエラー
https://stackoverflow.com/questions/2746916/getting-an-odd-error-sql-server-query-using-with-clause
奇妙なエラーが発生しました草
エラー内容
Failed to execute query. Error: Incorrect syntax near the keyword 'WITH'.
Incorrect syntax near the keyword 'with'. If this statement is a common table expression, an xmlnamespaces clause or a change tracking context clause, the previous statement must be terminated with a semicolon.

→BULK3を実装で別のエラー
Failed to execute query. Error: A correlation name must be specified for the bulk rowset in the from clause.
【解決】
https://www.kodyaz.com/articles/correlation-name-for-bulk-rowset-in-from-clause.aspx
→AS dataFileが必要、データテーブルに名前を付けてあげないと意味がないでしょというエラー
　つまりエイリアス名を要求されていた

→BULK３を修正して実行、次のエラー
Failed to execute query. Error: The hint 'firstrow' cannot be used with the hint 'single_clob'.

→文字通り

最後のエラー
Failed to execute query. Error: Referenced external data source "MyAzureBlobStorage" not found.

結局これかよ。。


課題㉗：
時間経過でガラガラ出てくるイベント、
1s経過、スタート、2s経過、スタート、3s経過、スタート
→updateメソッドは呼び出す必要がないのかもしれないいろいろやり直し
→だめ

課題㉘：
now = pg.time.get_ticks()
        if now - self.mob_timer > 5000 + random.choice(
                [-1000, -500, 0, 500, 1000]):
            self.mob_timer = now
            Mob(self)
→クラス宣言で自由に呼び出せる

課題㉙：


●python
コンボボックスとドロップダウン、何が異なるのか

pygame
mouse hoverを勉強しているといろいろ勉強になった
cache = {}
という使い方、というか辞書型が使いやすすぎる
cache作って→cache[False][文字]を投げる、謎、投後は(t, render(t).get_rect())をobjetcsに格納
→スペルミス？なんかよくあるやつなのだろうか
→画像をボタンにする機能を作成できそう

↓面白い使いかたわざわざif文をまじめに書く必要がない
self.cache[mod][text] = (mod_font if mod else base_font).render(text, True, (255, 255, 255))

→レンダリング処理を回避することができる
　→ただこんな大げさに回避する必要があるかどうかは疑問

■メモ
★python技術
①イベント後エラーメッセージを指定の場所に表示可能
→ファンクションでgird配置指定で生成する（Validateを走らせた後実行有無を判定）


★要件
Displayの作成
ログイン→ホーム画面でキャラクター選択
→初期画面
①主人公データ読み込み
・キャラクタ、種族、遺伝子、地域、ダンジョン等マスタ取得
・左上にステータス表示
・描画を一度で済ます？

②表示（Spritesシート）
・キャラクタ、アニメーション３D
→SpritesシートPlayerクラス実装
・周りのオブジェクト
→SpritesシートBuildingクラス実装？？
・NPC、敵
→SpritesシートMobクラス実装
・シンボル
→SpritesシートSymbolクラス実装

③プラットフォーム（Platformシート）
〇表示範囲
→拡大可能、ライキン参考、上から視点、町は家など建物
〇表示物
→視点移動時は地面と木だけの描写、操作停止時にオブジェクトを描画する
〇再描画
→プレイヤーコマンド選択時

④操作
・十字キー移動
→視点移動、キャラ移動（キャラにフォーカス時）
・

最初は地方という単位もない
国を作った瞬間に座標がすべて登録される

絶対値を求めるときはabs関数
y = abs(-5)
→5になる


■8月～PJマップ作製GUI
★要件
・マップを作成したい
・マップ構成→登録先（fields,locations,areas,spots)

→採掘、農場ポイントはランダムに点在している（spotごと）
→スポットはランダムに変動する（バッチで操作）
→採取スポットのレベルは高い土地と低い土地が存在する
→採取スポットが高い土地は生産性が高い
→スポットを等高線図で視覚的に表示できるとよい
→天気図も欲しいかもしれない
→ポイント準拠ではない
→土地の高さ、川の必要性
→地方ごとに土地の傾斜を決めてあげることで計算による平均傾斜の割り出しが可能
→傾斜は定数、最高点の数、それぞれの高さと平地の数で決定する
→それぞれのスポットの高さは、最高到達点との距離、と傾斜で三角比から求めた最高点となる
→傾斜以外は平地とする、平均高度から逆算することもおそらく可能と思われる
→最高高度→準最高... というように高度を決めていく必要がある、高度の決め方は不明。地学は知らない
→あるいはデータ分析DeepLearningでデータの扱い方を学ぶか。
・一度DeepLearningに戻る必要がある
→高度を決めると川を作成可能。川のふもとには人里が作成可能
→川は海まで流れる。高度に比例して流水量を決定する
→流路は基本的に高→低に流れる、平地では直線で海まで（演算難易度高）


・マップ部５：８の長方形型→世界地図とするタッチすることで一部を拡大可能？
・ドラッグでマップを移動可能（スマホの場合スワイプ）？
・クリックで選択個所を編集可能→地方のマップ、ドラッグで建築物の移動等が可能
・左下で選択した地方を右上に表示
・川の流路編集？
・川は分岐する→流量に比例
・気温、偏西風等、寒い地域の人種、
→寒冷地：技術力が発展、温暖：バランスよく発展、南地域：農場が発展、砂漠地帯：身体能力が発展
→登録処理はDELETE/INSERTのみ
・登録先は王国、地方、スポットの3種類
→登録方法は地形登録（スポット）のみ	


〇王国作成手順追加
　【課題】
　パターンが小手先感が強めでマップ作製が感覚的にできなさそう
　・何をどのように実装するか
　・道と建物・・・地区単位で道を血続きにすること、ルールが必要
　→道は5の倍数とする（共通事項）
　→ImageDrawでMapを作成
　・領土の結合、分裂：奪った土地を結合する
　→結合：地方同士、王国同士、戦争で勝利すると融合、内部同士の場合は一定条件で結合可能
　→分裂：上に同じ、ストレスがたまると分裂
　→マップは緯度経度で計算してもよかったのかもしれない、この場合下位→上位とレベルを上げていく
　　作成方法なので今とは真逆の方法になってしまう？
　EX
　●鍛冶屋
　→鍛冶屋、教会等すべてマスタ分けするかどうか、
　→鍛冶屋項目→武具作成が可能（鍛冶F-SSS）鍛冶屋の大金の使い道
　　→ランク上げに必要、従業員の育成、
　　→従業員のランク上げに必要
　　→強力な武具を作成可能、（TODO：アイテムを所持、使用可能なようにする）
　●教会
　→鍛冶屋があると戦争で有利になる、戦争時部隊にバフがかかる
　→教会あり→キャラクターのクラスを変更可能ランク別、
　→大金の使い道
　　→ランク上げ、維持費、従業員の育成、サブ拠点の作成
　　→けがをしたときの治療が早くなる→回転が速くなる
　●ギルド
　→戦争で有利になる、ギルドランクを発行、ギルド員をサポート
　→ギルド員はダンジョンに挑戦することが可能、ギルド員はパーティを作成可能
　　→ギルドランクが上がるほど取得経験値量が増える
　　→ギルド員の行動量が増える（モチベーション的な意味で）


■進捗

12/2
衝撃。11月上旬に既に課金画面のほとんどをクリアしてしまっていた（画像作成済み）
→残りの2週間弱は何をしていたんだ。
・今日はsql server(Azure SQL)の検証

12/10 熊田さん案件スタート

プラグイン編集注意

注意 !
------------------------------------------------------
WordPress ダッシュボードで、プラグインを直接編集しているようです。直接編集しないよう、お勧めします。直接プラグインを編集すると互換性が失われ、サイトを破壊する可能性があります。また将来のプラグインの更新により変更が失われる場合があります。

もしどうしても、このプラグインを直接編集する必要がある場合、新しい名前のコピーを作り、オリジナルを保存してください。そうすることで、何かがうまくいかない場合でも、動作可能なバージョンを再度有効化することができます。
-------------------------------------------------------



★概要設計スケッチ要件まとめ
・スマホから簡単にランダムでガチャができるように（演出はPA？）
→ゲーム機能ではないので、単純にロジックだけ。実装検証
→メインはフローの実装、pythonロジックをカスタムコネクタに実装HTTPでcosmos dbにデータを投げる
→機能はcharacter作成, mapデータ調整（ステータスとかいろいろ）とりあえず
→オンプレミスが使えるので一覧として表示するのもあり、死亡とそうでないもののステータスなど
→データ件数が多くなってきた場合、いきなりゴリゴリバックオフィスを進める必要がないよう対策
→powerアプリはあくまで検証用、使い勝手などを確かめてからpythonで実装
→pythonではHTTP通信を実施するのでそのあたりの知識を勉強する
→いよいよゲームアプリケーションの実装、少し面倒
→少人数で遊ぶ、同じ画面で、相手の動きがすぐにわかる←同実装しよう、、mmoRPGかな

■仕事調査系
保留

■Unity
スクリプト記述ポイント
・UnityEngine.UIはライブラリ名を記載しなければならない
・ゲームオブジェクト座標の取得transform.positionで取得可能
・

■マップ
OpenAPI機能利用
→ZenDesk、zooAPI？


メモ（マップ）
登録ボタン→entryField
　どちらかというと更新、field、location
新規登録→entryNewKingdom
　こちらはマップ新規
　


MySQL初歩で引っかかってしまう
→varcharの文字数制限を設定しないと怒られる（めんどくさい）

#!/usr/bin/env python
import tkinter as tk


# 実験コード
root = tk.Tk()
c = tk.Canvas(root, width = 600, height = 200)
c.create_polygon(10,10,30,10,30,20,50,20,50,40,70,40,70,30,90,30,90,10,100,10,100,20,120,20,120,40,130,40,10,40)
c.create_polygon(285, 20, 320, 150, 220, 80, 350, 80, 250, 150, fill = '#0000ff')
c.create_polygon(485, 20, 550, 80, 520, 150, 450, 150, 420, 80, smooth = True)
c.pack()

root.mainloop()

11/09進捗
powerappsでバルクイン実装

バッチの実装
・1日1000件のキャラクターを作成
・フィールドは個別作成
・pygameでもギャラリーで表示したいが、ギャラリーはないのか

11/30進捗
11月最後
pygameの方は順調、画像表示などは少しごり押し感が強くなってきた気がする
spriteを使っている人の方がうまく作っている気がする、

12/1
今日の教訓
Spriteクラスのデータを使おうとしたが
以前のShopとは完全に別物。結局前回の完成系をぶち壊す感じになってしまった

・オブジェクト指向
→無理に画像（吹き出し、課金騎士）をクラス化する必要はなかったかもしれない
→Spriteクラスはあらかじめ、出現位置が決まっている傾向にある（ランダムとか）
→画面側で出力ロケーションを決めているが、俺の方は共通関数化してしまっている
→ここで、わざわざクラス化して、変数の距離感を遠くする必要はなかったと思われる
普通にload_dataでアニメーション化することになると思う→何の意味があったというのか

3枚の画像をぱらぱらめくることになってしまうので、これではアニメーションにならない
ではどうするのか？

12/3 Unity
Rotate→回転メソッド
